<img src="doc/subbrand-stm32.svg" width="50"/>

# __Basic stdio__

This component provides a basic `stdout` redirection service (usable through e.g., `printf`) to report information from STM32 devices to a terminal.

## __Summary__

This component provides a basic `stdout` redirection service (usable through e.g., `printf`) to report information from STM32 devices to a terminal.

By design, the API is minimalist:
- `void UTIL_BASIC_STDIO_Init(void* pobj);`: initialization function. The exact nature of pobj depends on the selected I/O medium.
- some libc APIs that interact with `stdout`, typically `printf()`...

Several low level services can be selected to actually transmit the data:
- UART mode (depending on STM32 HAL UART)
- ITM mode (depending only on ARM CMSIS CORE)

The component can be selected statically, and also as a template for your own implementation.

## __Folder structure__

This component is structured around the header `basic_stdio_core.h` (found at the root of the component).
This header contains definitions meant to be included in user code (mainly `UTIL_BASIC_STDIO_Init()`).
The header `priv_inc/stm32_basic_stdio_internal.h` contains "private" definitions that are meant only for code within this component.
These definitions are mostly about handling differences in the libc hooks definitions.

Finally, three variants of the trace service are available:
- an UART-based implementation, located in uart/;
- an ITM-based implementation, located in itm/;
- a template implementation in template/,
  meant to be copied in userspace and filled by the project developer.

## __Description__

#### __UART and ITM variants__

It will be your responsibility to provide the low level component to actually transmit the data:
- UART: initialize the UART instance manually in polling mode, then pass it in to `UTIL_BASIC_STDIO_Init()` before using `stdout`;
- ITM: no hardware instance is required, just call `UTIL_BASIC_STDIO_Init(NULL)` before using `printf()`.

#### __Custom variant__ with user templates

This variant makes no assumption about the technology you want to use to evacuate the trace.
The API to implement is the same as in the other modules. As they depend on the toolchain used to build the project,
a template is provided with all the necessary definitions, that you just have to fill in.

## __How to use it?__

0. Include `stm32_basic_stdio.h`.
0. (UART) Initialize the hardware instance you want to use (UART handle), in polling mode, with the desired baudrate, stop bits...
0. Call `UTIL_BASIC_STDIO_Init()` as documented above.
0. Start using `printf()` normally to emit logs.

To help disable the trace efficiently, it is recommended not to use `printf()` directly.
The call to `printf()` should be wrapped in a conditionally-defined macro in the project, with a control macro to help disable it globally:
```c
#if defined(USE_PRINTF) && USE_PRINTF != 0
#define PRINTF(...) print(__VA_ARGS__)
#else
#define PRINTF(...) /* discarded */
#endif
```

## __Tests__

This component has been tested against Teraterm for the UART low layer:

https://osdn.net/projects/ttssh2/releases/

with the following default configuration:
- baudrate set to 115200,
- 8 bits word length,
- no flow control,
- no parity
## __Restrictions__

### __Device level__

The ITM is an optional feature of ARM Cortex-M cores which formats and outputs trace information generated by the firmware or directly from the hardware over a dedicated bus.

> Note: ITM is not available on Cortex-M0, M0+, and M23 based microcontrollers.

### __Board level__

The ITM can be supported by ST-Link v2 and greater as it requires only the SWO signal which is always routed on Nucleo boards (and greater) with more than 32 pins.

Unfortunately, the SWO pin is not always connected to the corresponding pin of the integrated ST-Link debugger so using this solution might require reworking the board or using an external probe.

> Note: Nucleo32 boards cannot afford dedicating one pin to SWO, so it is not connected.


## __Contributing__

STM32 customers and users who want to contribute to this component can follow instructions on [STMicroelectronics GitHub page](https://github.com/STMicroelectronics)

## __Keywords__

basic stdio, serial, ITM, UART, log

## __License__

Copyright (c) 2025 STMicroelectronics.

This software is licensed under terms that can be found in the LICENSE file in the root directory of this software component.
If no LICENSE file comes with this software, it is provided AS-IS.
