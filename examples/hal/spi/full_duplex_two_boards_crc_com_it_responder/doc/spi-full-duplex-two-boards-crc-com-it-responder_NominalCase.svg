<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2725px" preserveAspectRatio="none" style="width:2203px;height:2725px;background:#EEEBDC;" version="1.1" viewBox="0 0 2203 2725" width="2203.125px" zoomAndPan="magnify"><defs/><g><rect fill="#EEEBDC" height="2725" style="stroke:none;stroke-width:3.125;" width="2203.125" x="0" y="0"/><text fill="#000000" font-family="sans-serif" font-size="43.75" font-weight="bold" lengthAdjust="spacing" textLength="1240.625" x="468.75" y="92.2913">Nominal SPI full-duplex communication in interrupt mode</text><rect fill="#DDDDDD" height="2567.9932" style="stroke:#181818;stroke-width:1.5625;" width="1168.75" x="378.125" y="139.4043"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="343.75" x="790.625" y="181.5765">Responder Board</text><rect fill="#DDDDDD" height="2567.9932" style="stroke:#181818;stroke-width:1.5625;" width="359.375" x="1678.125" y="139.4043"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="328.125" x="1693.75" y="181.5765">Controller Board</text><rect fill="#A9DCDF" height="2231.8359" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="542.1875" y="336.1572"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="542.1875" x2="542.1875" y1="336.1572" y2="2567.9932"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="573.4375" x2="573.4375" y1="336.1572" y2="2567.9932"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="542.1875" x2="573.4375" y1="336.1572" y2="336.1572"/><rect fill="#A9DCDF" height="268.9209" style="stroke:#0000FF;stroke-width:3.125;" width="31.25" x="1317.1875" y="1034.4727"/><rect fill="#A9DCDF" height="2231.8359" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="1842.1875" y="336.1572"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="1842.1875" x2="1842.1875" y1="336.1572" y2="2567.9932"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="1873.4375" x2="1873.4375" y1="336.1572" y2="2567.9932"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="1842.1875" x2="1873.4375" y1="336.1572" y2="336.1572"/><rect fill="none" height="1576.3428" style="stroke:#000000;stroke-width:4.6875;" width="1962.5" x="187.5" y="610.2295"/><rect fill="none" height="1249.1455" style="stroke:#000000;stroke-width:4.6875;" width="1900" x="218.75" y="828.0518"/><rect fill="none" height="637.6221" style="stroke:#000000;stroke-width:4.6875;" width="1759.375" x="328.125" y="907.2754"/><rect fill="none" height="441.6748" style="stroke:#000000;stroke-width:4.6875;" width="1696.875" x="359.375" y="1081.3477"/><rect fill="#F0F8FF" height="194.6289" style="stroke:none;stroke-width:3.125;" width="1696.875" x="359.375" y="1328.3936"/><rect fill="none" height="466.6748" style="stroke:#000000;stroke-width:4.6875;" width="1387.5" x="250" y="1588.6475"/><rect fill="none" height="365.5762" style="stroke:#000000;stroke-width:4.6875;" width="1325" x="281.25" y="1667.8711"/><rect fill="#F0F8FF" height="194.6289" style="stroke:none;stroke-width:3.125;" width="1325" x="281.25" y="1838.8184"/><rect fill="none" height="170.9473" style="stroke:#000000;stroke-width:4.6875;" width="1190.625" x="350" y="2368.9209"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="556.25" x2="556.25" y1="304.9072" y2="2596.1182"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="1331.25" x2="1331.25" y1="304.9072" y2="2596.1182"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="1856.25" x2="1856.25" y1="304.9072" y2="2596.1182"/><rect fill="#90EE90" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="209.375" x="453.125" y="203.0029"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="165.625" x="475" y="270.2942">Example</text><rect fill="#90EE90" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="209.375" x="453.125" y="2592.9932"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="165.625" x="475" y="2660.2844">Example</text><rect fill="#ADD8E6" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="278.125" x="1193.75" y="203.0029"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="234.375" x="1215.625" y="270.2942">HAL Drivers</text><rect fill="#ADD8E6" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="278.125" x="1193.75" y="2592.9932"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="234.375" x="1215.625" y="2660.2844">HAL Drivers</text><rect fill="#90EE90" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="209.375" x="1753.125" y="203.0029"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="165.625" x="1775" y="270.2942">Example</text><rect fill="#90EE90" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="209.375" x="1753.125" y="2592.9932"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="165.625" x="1775" y="2660.2844">Example</text><rect fill="#A9DCDF" height="2231.8359" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="542.1875" y="336.1572"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="542.1875" x2="542.1875" y1="336.1572" y2="2567.9932"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="573.4375" x2="573.4375" y1="336.1572" y2="2567.9932"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="542.1875" x2="573.4375" y1="336.1572" y2="336.1572"/><rect fill="#A9DCDF" height="268.9209" style="stroke:#0000FF;stroke-width:3.125;" width="31.25" x="1317.1875" y="1034.4727"/><rect fill="#A9DCDF" height="2231.8359" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="1842.1875" y="336.1572"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="1842.1875" x2="1842.1875" y1="336.1572" y2="2567.9932"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="1873.4375" x2="1873.4375" y1="336.1572" y2="2567.9932"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="1842.1875" x2="1873.4375" y1="336.1572" y2="336.1572"/><rect fill="#EEEEEE" height="9.375" style="stroke:#EEEEEE;stroke-width:3.125;" width="2181.25" x="0" y="402.3315"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2181.25" y1="402.3315" y2="402.3315"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2181.25" y1="411.7065" y2="411.7065"/><rect fill="#EEEEEE" height="76.0986" style="stroke:#000000;stroke-width:6.25;" width="512.5" x="834.375" y="367.4072"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="456.25" x="853.125" y="422.0795">Initialization: app_init()</text><path d="M587.5,490.3809 L587.5,571.6309 L1431.25,571.6309 L1431.25,521.6309 L1400,490.3809 L587.5,490.3809 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><path d="M1400,490.3809 L1400,521.6309 L1431.25,521.6309 L1400,490.3809 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="778.125" x="606.25" y="548.1781">The application initializes the SPI instance.</text><path d="M187.5,610.2295 L415.625,610.2295 L415.625,636.3281 L384.375,667.5781 L187.5,667.5781 L187.5,610.2295 " fill="#EEEEEE" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="1576.3428" style="stroke:#000000;stroke-width:4.6875;" width="1962.5" x="187.5" y="610.2295"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="87.5" x="234.375" y="655.5267">loop</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacing" textLength="540.625" x="462.5" y="652.1637">[EXAMPLE_LOOP_COUNT times]</text><rect fill="#EEEEEE" height="9.375" style="stroke:#EEEEEE;stroke-width:3.125;" width="2181.25" x="0" y="733.7524"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2181.25" y1="733.7524" y2="733.7524"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2181.25" y1="743.1274" y2="743.1274"/><rect fill="#EEEEEE" height="76.0986" style="stroke:#000000;stroke-width:6.25;" width="328.125" x="926.5625" y="698.8281"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="271.875" x="945.3125" y="753.5004">app_process()</text><path d="M218.75,828.0518 L446.875,828.0518 L446.875,854.1504 L415.625,885.4004 L218.75,885.4004 L218.75,828.0518 " fill="#EEEEEE" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="1249.1455" style="stroke:#000000;stroke-width:4.6875;" width="1900" x="218.75" y="828.0518"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="87.5" x="265.625" y="873.349">loop</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacing" textLength="425" x="493.75" y="869.986">[Until max retry reached]</text><path d="M328.125,907.2754 L1512.5,907.2754 L1512.5,933.374 L1481.25,964.624 L328.125,964.624 L328.125,907.2754 " fill="#EEEEEE" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="637.6221" style="stroke:#000000;stroke-width:4.6875;" width="1759.375" x="328.125" y="907.2754"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="1043.75" x="375" y="952.5726">Transmission and reception of data by the responder</text><polygon fill="#0000FF" points="1279.6875,1021.9727,1310.9375,1034.4727,1279.6875,1046.9727,1292.1875,1034.4727" style="stroke:#0000FF;stroke-width:3.125;"/><line style="stroke:#0000FF;stroke-width:6.25;" x1="573.4375" x2="1298.4375" y1="1034.4727" y2="1034.4727"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="537.5" x="595.3125" y="1019.2963">HAL_SPI_TransmitReceive_IT</text><path d="M359.375,1081.3477 L550,1081.3477 L550,1107.4463 L518.75,1138.6963 L359.375,1138.6963 L359.375,1081.3477 " fill="#EEEEEE" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="441.6748" style="stroke:#000000;stroke-width:4.6875;" width="1696.875" x="359.375" y="1081.3477"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="50" x="406.25" y="1126.6449">alt</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacing" textLength="659.375" x="596.875" y="1123.2819">[transmission and reception success]</text><ellipse cx="1346.875" cy="1206.2012" fill="none" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:4.6875;"/><line style="stroke:#000000;stroke-width:6.25;" x1="1368.75" x2="1400" y1="1208.5449" y2="1196.0449"/><line style="stroke:#000000;stroke-width:6.25;" x1="1368.75" x2="1400" y1="1208.5449" y2="1221.0449"/><ellipse cx="1840.625" cy="1206.2012" fill="none" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:4.6875;"/><line style="stroke:#000000;stroke-width:6.25;" x1="1818.75" x2="1787.5" y1="1208.5449" y2="1196.0449"/><line style="stroke:#000000;stroke-width:6.25;" x1="1818.75" x2="1787.5" y1="1208.5449" y2="1221.0449"/><line style="stroke:#000000;stroke-width:6.25;" x1="1348.4375" x2="1821.875" y1="1208.5449" y2="1208.5449"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="418.75" x="1401.5625" y="1193.3685">full-duplex data transfer</text><polygon fill="#0000FF" points="607.8125,1290.8936,576.5625,1303.3936,607.8125,1315.8936,595.3125,1303.3936" style="stroke:#0000FF;stroke-width:3.125;"/><line style="stroke:#0000FF;stroke-width:6.25;stroke-dasharray:2.0,2.0;" x1="589.0625" x2="1329.6875" y1="1303.3936" y2="1303.3936"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="509.375" x="626.5625" y="1288.2172">HAL_SPI_TxRxCpltCallback</text><line style="stroke:#000000;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="359.375" x2="2056.25" y1="1331.5186" y2="1331.5186"/><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacing" textLength="659.375" x="375" y="1367.2028">[Transmission and/or reception error]</text><rect fill="none" height="129.5166" style="stroke:#000000;stroke-width:4.6875;" width="1162.5" x="381.25" y="1377.8809"/><path d="M381.25,1377.8809 L575,1377.8809 L575,1402.8809 L543.75,1434.1309 L381.25,1434.1309 L381.25,1377.8809 " fill="#EEEEEE" style="stroke:#000000;stroke-width:6.25;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="53.125" x="421.875" y="1426.3031">ref</text><text fill="#000000" font-family="sans-serif" font-size="37.5" lengthAdjust="spacing" textLength="559.375" x="409.375" y="1485.5591">New data exchange attempt, see</text><text fill="#000000" font-family="sans-serif" font-size="37.5" font-weight="bold" lengthAdjust="spacing" textLength="537.5" x="978.125" y="1485.5591">Communication error handling</text><path d="M250,1588.6475 L1321.875,1588.6475 L1321.875,1614.7461 L1290.625,1645.9961 L250,1645.9961 L250,1588.6475 " fill="#EEEEEE" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="466.6748" style="stroke:#000000;stroke-width:4.6875;" width="1387.5" x="250" y="1588.6475"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="931.25" x="296.875" y="1633.9447">Responder compares sent and received buffers</text><path d="M281.25,1667.8711 L471.875,1667.8711 L471.875,1693.9697 L440.625,1725.2197 L281.25,1725.2197 L281.25,1667.8711 " fill="#EEEEEE" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="365.5762" style="stroke:#000000;stroke-width:4.6875;" width="1325" x="281.25" y="1667.8711"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="50" x="328.125" y="1713.1683">alt</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacing" textLength="168.75" x="518.75" y="1709.8053">[identical]</text><path d="M312.5,1740.8447 L312.5,1822.0947 L1575,1822.0947 L1575,1772.0947 L1543.75,1740.8447 L312.5,1740.8447 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><path d="M1543.75,1740.8447 L1543.75,1772.0947 L1575,1772.0947 L1543.75,1740.8447 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="1196.875" x="331.25" y="1798.642">The responder updates the transmission buffer for the next transfer</text><line style="stroke:#000000;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="281.25" x2="1606.25" y1="1841.9434" y2="1841.9434"/><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacing" textLength="175" x="296.875" y="1877.6276">[different]</text><rect fill="none" height="129.5166" style="stroke:#000000;stroke-width:4.6875;" width="1162.5" x="381.25" y="1888.3057"/><path d="M381.25,1888.3057 L575,1888.3057 L575,1913.3057 L543.75,1944.5557 L381.25,1944.5557 L381.25,1888.3057 " fill="#EEEEEE" style="stroke:#000000;stroke-width:6.25;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="53.125" x="421.875" y="1936.7279">ref</text><text fill="#000000" font-family="sans-serif" font-size="37.5" lengthAdjust="spacing" textLength="475" x="451.5625" y="1995.9839">New exchange attempt, see</text><text fill="#000000" font-family="sans-serif" font-size="37.5" font-weight="bold" lengthAdjust="spacing" textLength="537.5" x="935.9375" y="1995.9839">Communication error handling</text><rect fill="#EEEEEE" height="9.375" style="stroke:#EEEEEE;stroke-width:3.125;" width="2181.25" x="0" y="2139.6973"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2181.25" y1="2139.6973" y2="2139.6973"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2181.25" y1="2149.0723" y2="2149.0723"/><rect fill="#EEEEEE" height="9.375" style="stroke:#EEEEEE;stroke-width:3.125;" width="2181.25" x="0" y="2274.6216"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2181.25" y1="2274.6216" y2="2274.6216"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2181.25" y1="2283.9966" y2="2283.9966"/><rect fill="#EEEEEE" height="76.0986" style="stroke:#000000;stroke-width:6.25;" width="615.625" x="782.8125" y="2239.6973"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="559.375" x="801.5625" y="2294.3695">Deinitialization: app_deinit()</text><path d="M350,2368.9209 L840.625,2368.9209 L840.625,2395.0195 L809.375,2426.2695 L350,2426.2695 L350,2368.9209 " fill="#008000" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="170.9473" style="stroke:#000000;stroke-width:4.6875;" width="1190.625" x="350" y="2368.9209"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="350" x="396.875" y="2414.2181">success_handler()</text><path d="M381.25,2441.8945 L381.25,2523.1445 L1509.375,2523.1445 L1509.375,2473.1445 L1478.125,2441.8945 L381.25,2441.8945 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><path d="M1478.125,2441.8945 L1478.125,2473.1445 L1509.375,2473.1445 L1478.125,2441.8945 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="728.125" x="567.1875" y="2499.6918">Responder stays in the success handler</text><line style="stroke:#000000;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="0" x2="2181.25" y1="2561.7432" y2="2561.7432"/><!--MD5=[45f321b2078da0fbf2da1fabff3b98c5]
@startuml spi-full-duplex-two-boards-crc-com-it-responder_NominalCase
' style
skinparam backgroundColor #EEEBDC
skinparam ParticipantPadding 20
skinparam BoxPadding 20
skinparam backgroundColor #EEEBDC
skinparam dpi 300

skinparam sequence {
	ArrowColor blue
	ActorBorderColor DeepSkyBlue
	LifeLineBorderColor blue
	LifeLineBackgroundColor #A9DCDF
	ArrowThickness 2
}

' chart
title **Nominal SPI full-duplex communication in interrupt mode**

box "Responder Board"
	participant "Example" as CtrlEx #lightgreen
	participant "HAL Drivers" as CtrlHAL #lightblue
end box
box "Controller Board"
	participant "Example" as RespEx #lightgreen
end box

== Initialization: app_init() ==
activate CtrlEx
	note right CtrlEx
		The application initializes the SPI instance.
	endnote
activate RespEx

loop EXAMPLE_LOOP_COUNT times
  == app_process() ==
  loop Until max retry reached
    group Transmission and reception of data by the responder
      CtrlEx -> CtrlHAL : HAL_SPI_TransmitReceive_IT
      activate CtrlHAL

      alt transmission and reception success
        CtrlHAL o<<-[#black]>>o RespEx : full-duplex data transfer
        CtrlEx <- - CtrlHAL: HAL_SPI_TxRxCpltCallback
        deactivate CtrlHAL

      else #ALICEBLUE Transmission and/or reception error
        ref over CtrlEx, CtrlHAL
        New data exchange attempt, see **Communication error handling**
        end ref
      end

    end

    group Responder compares sent and received buffers
      alt identical
        note over CtrlEx, CtrlHAL
        The responder updates the transmission buffer for the next transfer
        end note

      else #ALICEBLUE different
        ref over CtrlEx, CtrlHAL
        New exchange attempt, see **Communication error handling**
        end ref

      end
    end
  end
  == ==

end
== Deinitialization: app_deinit() ==

group#GREEN  success_handler()
  note over CtrlEx, CtrlHAL
    Responder stays in the success handler
  endnote
end

newpage Attempts mechanism

== app_process() ==
... Data transfer ...
  note over CtrlEx,CtrlHAL
  Failure during SPI transmission and/or reception in interrupt mode
  endnote
CtrlHAL x-[#black]>>x RespEx : Data transfer stopped
  activate CtrlHAL
CtrlEx <- - CtrlHAL: HAL_SPI_ErrorCallback,\nHAL_ERROR or HAL_TIMEOUT
  deactivate CtrlHAL

group Communication error handling
    alt Responder max attempts reached
      note over CtrlEx
        Stop the communication and exit app_process()
      endnote
			ref over CtrlEx, CtrlHAL
        Report the error status, see **error_handler()**
      end ref
		else #ALICEBLUE Responder retry
      note over CtrlEx, CtrlHAL
        Decrement the number of remaining attempts
      endnote
			ref over CtrlEx, CtrlHAL
			  Restart a new data exchange, see **exchanging data**
			end ref
		end
end

== ==
group#GOLD  error_handler()
  note over CtrlEx, CtrlHAL
    Responder stays in the error handler
  endnote
end
@enduml

@startuml spi-full-duplex-two-boards-crc-com-it-responder_NominalCase
skinparam backgroundColor #EEEBDC
skinparam ParticipantPadding 20
skinparam BoxPadding 20
skinparam backgroundColor #EEEBDC
skinparam dpi 300

skinparam sequence {
	ArrowColor blue
	ActorBorderColor DeepSkyBlue
	LifeLineBorderColor blue
	LifeLineBackgroundColor #A9DCDF
	ArrowThickness 2
}

title **Nominal SPI full-duplex communication in interrupt mode**

box "Responder Board"
	participant "Example" as CtrlEx #lightgreen
	participant "HAL Drivers" as CtrlHAL #lightblue
end box
box "Controller Board"
	participant "Example" as RespEx #lightgreen
end box

== Initialization: app_init() ==
activate CtrlEx
	note right CtrlEx
		The application initializes the SPI instance.
	endnote
activate RespEx

loop EXAMPLE_LOOP_COUNT times
  == app_process() ==
  loop Until max retry reached
    group Transmission and reception of data by the responder
      CtrlEx -> CtrlHAL : HAL_SPI_TransmitReceive_IT
      activate CtrlHAL

      alt transmission and reception success
        CtrlHAL o<<-[#black]>>o RespEx : full-duplex data transfer
        CtrlEx <- - CtrlHAL: HAL_SPI_TxRxCpltCallback
        deactivate CtrlHAL

      else #ALICEBLUE Transmission and/or reception error
        ref over CtrlEx, CtrlHAL
        New data exchange attempt, see **Communication error handling**
        end ref
      end

    end

    group Responder compares sent and received buffers
      alt identical
        note over CtrlEx, CtrlHAL
        The responder updates the transmission buffer for the next transfer
        end note

      else #ALICEBLUE different
        ref over CtrlEx, CtrlHAL
        New exchange attempt, see **Communication error handling**
        end ref

      end
    end
  end
  == ==

end
== Deinitialization: app_deinit() ==

group#GREEN  success_handler()
  note over CtrlEx, CtrlHAL
    Responder stays in the success handler
  endnote
end

newpage Attempts mechanism

== app_process() ==
... Data transfer ...
  note over CtrlEx,CtrlHAL
  Failure during SPI transmission and/or reception in interrupt mode
  endnote
CtrlHAL x-[#black]>>x RespEx : Data transfer stopped
  activate CtrlHAL
CtrlEx <- - CtrlHAL: HAL_SPI_ErrorCallback,\nHAL_ERROR or HAL_TIMEOUT
  deactivate CtrlHAL

group Communication error handling
    alt Responder max attempts reached
      note over CtrlEx
        Stop the communication and exit app_process()
      endnote
			ref over CtrlEx, CtrlHAL
        Report the error status, see **error_handler()**
      end ref
		else #ALICEBLUE Responder retry
      note over CtrlEx, CtrlHAL
        Decrement the number of remaining attempts
      endnote
			ref over CtrlEx, CtrlHAL
			  Restart a new data exchange, see **exchanging data**
			end ref
		end
end

== ==
group#GOLD  error_handler()
  note over CtrlEx, CtrlHAL
    Responder stays in the error handler
  endnote
end
@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>