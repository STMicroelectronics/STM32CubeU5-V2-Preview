<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2196.875px" preserveAspectRatio="none" style="width:2378px;height:2196px;background:#EEEBDC;" version="1.1" viewBox="0 0 2378 2196" width="2378.125px" zoomAndPan="magnify"><defs/><g><rect fill="#EEEBDC" height="2196.875" style="stroke:none;stroke-width:3.125;" width="2378.125" x="0" y="0"/><text fill="#000000" font-family="sans-serif" font-size="43.75" font-weight="bold" lengthAdjust="spacing" textLength="453.125" x="950" y="92.2913">Attempts mechanism</text><rect fill="#DDDDDD" height="2040.625" style="stroke:#181818;stroke-width:1.5625;" width="1168.75" x="378.125" y="139.4043"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="343.75" x="790.625" y="181.5765">Responder Board</text><rect fill="#DDDDDD" height="2040.625" style="stroke:#181818;stroke-width:1.5625;" width="359.375" x="1884.375" y="139.4043"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="328.125" x="1900" y="181.5765">Controller Board</text><rect fill="#A9DCDF" height="144.8486" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="542.1875" y="336.1572"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="542.1875" x2="542.1875" y1="336.1572" y2="481.0059"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="573.4375" x2="573.4375" y1="336.1572" y2="481.0059"/><rect fill="#A9DCDF" height="1428.8818" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="542.1875" y="611.7432"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="542.1875" x2="542.1875" y1="611.7432" y2="2040.625"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="573.4375" x2="573.4375" y1="611.7432" y2="2040.625"/><rect fill="#A9DCDF" height="145.9473" style="stroke:#0000FF;stroke-width:3.125;" width="31.25" x="1317.1875" y="795.1904"/><rect fill="#A9DCDF" height="144.8486" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="2048.4375" y="336.1572"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="2048.4375" x2="2048.4375" y1="336.1572" y2="481.0059"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="2079.6875" x2="2079.6875" y1="336.1572" y2="481.0059"/><rect fill="#A9DCDF" height="1428.8818" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="2048.4375" y="611.7432"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="2048.4375" x2="2048.4375" y1="611.7432" y2="2040.625"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="2079.6875" x2="2079.6875" y1="611.7432" y2="2040.625"/><rect fill="none" height="725.415" style="stroke:#000000;stroke-width:4.6875;" width="1568.75" x="28.125" y="988.0127"/><rect fill="none" height="624.3164" style="stroke:#000000;stroke-width:4.6875;" width="1506.25" x="59.375" y="1067.2363"/><rect fill="#F0F8FF" height="308.2275" style="stroke:none;stroke-width:3.125;" width="1506.25" x="59.375" y="1383.3252"/><rect fill="none" height="170.9473" style="stroke:#000000;stroke-width:4.6875;" width="1190.625" x="350" y="1844.6777"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="556.25" x2="556.25" y1="304.9072" y2="481.0059"/><line style="stroke:#0000FF;stroke-width:3.125;stroke-dasharray:1.0,4.0;" x1="556.25" x2="556.25" y1="481.0059" y2="611.7432"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="556.25" x2="556.25" y1="611.7432" y2="2068.75"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="1331.25" x2="1331.25" y1="304.9072" y2="481.0059"/><line style="stroke:#0000FF;stroke-width:3.125;stroke-dasharray:1.0,4.0;" x1="1331.25" x2="1331.25" y1="481.0059" y2="611.7432"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="1331.25" x2="1331.25" y1="611.7432" y2="2068.75"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="2062.5" x2="2062.5" y1="304.9072" y2="481.0059"/><line style="stroke:#0000FF;stroke-width:3.125;stroke-dasharray:1.0,4.0;" x1="2062.5" x2="2062.5" y1="481.0059" y2="611.7432"/><line style="stroke:#0000FF;stroke-width:1.5625;stroke-dasharray:5.0,5.0;" x1="2062.5" x2="2062.5" y1="611.7432" y2="2068.75"/><rect fill="#90EE90" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="209.375" x="453.125" y="203.0029"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="165.625" x="475" y="270.2942">Example</text><rect fill="#90EE90" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="209.375" x="453.125" y="2065.625"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="165.625" x="475" y="2132.9163">Example</text><rect fill="#ADD8E6" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="278.125" x="1193.75" y="203.0029"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="234.375" x="1215.625" y="270.2942">HAL Drivers</text><rect fill="#ADD8E6" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="278.125" x="1193.75" y="2065.625"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="234.375" x="1215.625" y="2132.9163">HAL Drivers</text><rect fill="#90EE90" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="209.375" x="1959.375" y="203.0029"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="165.625" x="1981.25" y="270.2942">Example</text><rect fill="#90EE90" height="98.7793" rx="7.8125" ry="7.8125" style="stroke:#181818;stroke-width:1.5625;" width="209.375" x="1959.375" y="2065.625"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacing" textLength="165.625" x="1981.25" y="2132.9163">Example</text><rect fill="#A9DCDF" height="144.8486" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="542.1875" y="336.1572"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="542.1875" x2="542.1875" y1="336.1572" y2="481.0059"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="573.4375" x2="573.4375" y1="336.1572" y2="481.0059"/><rect fill="#A9DCDF" height="1428.8818" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="542.1875" y="611.7432"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="542.1875" x2="542.1875" y1="611.7432" y2="2040.625"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="573.4375" x2="573.4375" y1="611.7432" y2="2040.625"/><rect fill="#A9DCDF" height="145.9473" style="stroke:#0000FF;stroke-width:3.125;" width="31.25" x="1317.1875" y="795.1904"/><rect fill="#A9DCDF" height="144.8486" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="2048.4375" y="336.1572"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="2048.4375" x2="2048.4375" y1="336.1572" y2="481.0059"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="2079.6875" x2="2079.6875" y1="336.1572" y2="481.0059"/><rect fill="#A9DCDF" height="1428.8818" style="stroke:#A9DCDF;stroke-width:3.125;" width="31.25" x="2048.4375" y="611.7432"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="2048.4375" x2="2048.4375" y1="611.7432" y2="2040.625"/><line style="stroke:#0000FF;stroke-width:3.125;" x1="2079.6875" x2="2079.6875" y1="611.7432" y2="2040.625"/><line style="stroke:#000000;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="0" x2="2356.25" y1="339.2822" y2="339.2822"/><rect fill="#EEEEEE" height="9.375" style="stroke:#EEEEEE;stroke-width:3.125;" width="2356.25" x="0" y="408.5815"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2356.25" y1="408.5815" y2="408.5815"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2356.25" y1="417.9565" y2="417.9565"/><rect fill="#EEEEEE" height="76.0986" style="stroke:#000000;stroke-width:6.25;" width="328.125" x="1014.0625" y="373.6572"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="271.875" x="1032.8125" y="428.3295">app_process()</text><text fill="#000000" font-family="sans-serif" font-size="34.375" lengthAdjust="spacing" textLength="200" x="1210.9375" y="560.4401">Data transfer</text><path d="M346.875,627.3682 L346.875,708.6182 L1540.625,708.6182 L1540.625,658.6182 L1509.375,627.3682 L346.875,627.3682 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><path d="M1509.375,627.3682 L1509.375,658.6182 L1540.625,658.6182 L1509.375,627.3682 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="1128.125" x="365.625" y="685.1654">Failure during SPI transmission and/or reception in DMA mode</text><line style="stroke:#000000;stroke-width:6.25;" x1="1370.3125" x2="1401.5625" y1="779.5654" y2="810.8154"/><line style="stroke:#000000;stroke-width:6.25;" x1="1370.3125" x2="1401.5625" y1="810.8154" y2="779.5654"/><line style="stroke:#000000;stroke-width:6.25;" x1="1992.1875" x2="2023.4375" y1="779.5654" y2="810.8154"/><line style="stroke:#000000;stroke-width:6.25;" x1="1992.1875" x2="2023.4375" y1="810.8154" y2="779.5654"/><line style="stroke:#000000;stroke-width:6.25;" x1="1385.9375" x2="2007.8125" y1="795.1904" y2="795.1904"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="387.5" x="1401.5625" y="780.014">Data transfer stopped</text><polygon fill="#0000FF" points="607.8125,928.6377,576.5625,941.1377,607.8125,953.6377,595.3125,941.1377" style="stroke:#0000FF;stroke-width:3.125;"/><line style="stroke:#0000FF;stroke-width:6.25;stroke-dasharray:2.0,2.0;" x1="589.0625" x2="1329.6875" y1="941.1377" y2="941.1377"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="443.75" x="626.5625" y="874.8627">HAL_SPI_ErrorCallback,</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="578.125" x="626.5625" y="925.9613">HAL_ERROR or HAL_TIMEOUT</text><path d="M28.125,988.0127 L778.125,988.0127 L778.125,1014.1113 L746.875,1045.3613 L28.125,1045.3613 L28.125,988.0127 " fill="#EEEEEE" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="725.415" style="stroke:#000000;stroke-width:4.6875;" width="1568.75" x="28.125" y="988.0127"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="609.375" x="75" y="1033.3099">Communication error handling</text><path d="M59.375,1067.2363 L250,1067.2363 L250,1093.335 L218.75,1124.585 L59.375,1124.585 L59.375,1067.2363 " fill="#EEEEEE" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="624.3164" style="stroke:#000000;stroke-width:4.6875;" width="1506.25" x="59.375" y="1067.2363"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="50" x="106.25" y="1112.5336">alt</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacing" textLength="612.5" x="296.875" y="1109.1705">[Responder max attempts reached]</text><path d="M90.625,1140.21 L90.625,1221.46 L1021.875,1221.46 L1021.875,1171.46 L990.625,1140.21 L90.625,1140.21 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><path d="M990.625,1140.21 L990.625,1171.46 L1021.875,1171.46 L990.625,1140.21 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="865.625" x="109.375" y="1198.0072">Stop the communication and exit app_process()</text><rect fill="none" height="129.5166" style="stroke:#000000;stroke-width:4.6875;" width="1162.5" x="381.25" y="1238.1836"/><path d="M381.25,1238.1836 L575,1238.1836 L575,1263.1836 L543.75,1294.4336 L381.25,1294.4336 L381.25,1238.1836 " fill="#EEEEEE" style="stroke:#000000;stroke-width:6.25;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="53.125" x="421.875" y="1286.6058">ref</text><text fill="#000000" font-family="sans-serif" font-size="37.5" lengthAdjust="spacing" textLength="468.75" x="587.5" y="1345.8618">Report the error status, see</text><text fill="#000000" font-family="sans-serif" font-size="37.5" font-weight="bold" lengthAdjust="spacing" textLength="271.875" x="1065.625" y="1345.8618">error_handler()</text><line style="stroke:#000000;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="59.375" x2="1565.625" y1="1386.4502" y2="1386.4502"/><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacing" textLength="309.375" x="75" y="1422.1344">[Responder retry]</text><path d="M381.25,1448.4375 L381.25,1529.6875 L1509.375,1529.6875 L1509.375,1479.6875 L1478.125,1448.4375 L381.25,1448.4375 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><path d="M1478.125,1448.4375 L1478.125,1479.6875 L1509.375,1479.6875 L1478.125,1448.4375 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="815.625" x="523.4375" y="1506.2347">Decrement the number of remaining attempts</text><rect fill="none" height="129.5166" style="stroke:#000000;stroke-width:4.6875;" width="1162.5" x="381.25" y="1546.4111"/><path d="M381.25,1546.4111 L575,1546.4111 L575,1571.4111 L543.75,1602.6611 L381.25,1602.6611 L381.25,1546.4111 " fill="#EEEEEE" style="stroke:#000000;stroke-width:6.25;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="53.125" x="421.875" y="1594.8334">ref</text><text fill="#000000" font-family="sans-serif" font-size="37.5" lengthAdjust="spacing" textLength="581.25" x="520.3125" y="1654.0894">Restart a new data exchange, see</text><text fill="#000000" font-family="sans-serif" font-size="37.5" font-weight="bold" lengthAdjust="spacing" textLength="293.75" x="1110.9375" y="1654.0894">exchanging data</text><rect fill="#EEEEEE" height="9.375" style="stroke:#EEEEEE;stroke-width:3.125;" width="2356.25" x="0" y="1775.9277"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2356.25" y1="1775.9277" y2="1775.9277"/><line style="stroke:#000000;stroke-width:3.125;" x1="0" x2="2356.25" y1="1785.3027" y2="1785.3027"/><path d="M350,1844.6777 L787.5,1844.6777 L787.5,1870.7764 L756.25,1902.0264 L350,1902.0264 L350,1844.6777 " fill="#FFD700" style="stroke:#000000;stroke-width:4.6875;"/><rect fill="none" height="170.9473" style="stroke:#000000;stroke-width:4.6875;" width="1190.625" x="350" y="1844.6777"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacing" textLength="296.875" x="396.875" y="1889.975">error_handler()</text><path d="M381.25,1917.6514 L381.25,1998.9014 L1509.375,1998.9014 L1509.375,1948.9014 L1478.125,1917.6514 L381.25,1917.6514 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><path d="M1478.125,1917.6514 L1478.125,1948.9014 L1509.375,1948.9014 L1478.125,1917.6514 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacing" textLength="656.25" x="603.125" y="1975.4486">Responder stays in the error handler</text><!--MD5=[c5ff205075757fae3e1d3011dbe31e56]
@startuml spi-full-duplex-two-boards-com-dma-Responder_NominalCase
' style
skinparam backgroundColor #EEEBDC
skinparam ParticipantPadding 20
skinparam BoxPadding 20
skinparam backgroundColor #EEEBDC
skinparam dpi 300

skinparam sequence {
	ArrowColor blue
	ActorBorderColor DeepSkyBlue
	LifeLineBorderColor blue
	LifeLineBackgroundColor #A9DCDF
	ArrowThickness 2
}

' chart
title **Nominal SPI full-duplex communication in DMA mode**

box "Responder Board"
	participant "Example" as CtrlEx #lightgreen
	participant "HAL Drivers" as CtrlHAL #lightblue
end box
box "Controller Board"
	participant "Example" as RespEx #lightgreen
end box

== Initialization: app_init() ==
activate CtrlEx
	note right CtrlEx
		The application initializes the SPI instance.
	endnote
activate RespEx

loop EXAMPLE_LOOP_COUNT times
  == app_process() ==
  loop Until max retry reached
    group Transmission and reception of data by the responder
      CtrlEx -> CtrlHAL : HAL_SPI_TransmitReceive_DMA
      activate CtrlHAL
      CtrlEx <- - CtrlHAL: HAL_OK
      CtrlHAL o<<-[#black]>>o RespEx : full-duplex data transfer between \nthe DMA and the Responder board

      alt transmission and reception success
        CtrlEx <- - CtrlHAL: HAL_SPI_TxRxCpltCallback
        deactivate CtrlHAL

      else #ALICEBLUE Transmission and/or reception error
        ref over CtrlEx, CtrlHAL
        New data exchange attempt, see **Communication error handling**
        end ref
      end

    end

    group Responder compares sent and received buffers
      alt identical
        note over CtrlEx, CtrlHAL
        The responder updates the transmission buffer for the next transfer
        end note

      else #ALICEBLUE different
        ref over CtrlEx, CtrlHAL
        New exchange attempt, see **Communication error handling**
        end ref

      end
    end
  end
  == ==

end
== Deinitialization: app_deinit() ==

group#GREEN  success_handler()
  note over CtrlEx, CtrlHAL
    Responder stays in the success handler
  endnote
end

newpage Attempts mechanism

== app_process() ==
... Data transfer ...
  note over CtrlEx,CtrlHAL
  Failure during SPI transmission and/or reception in DMA mode
  endnote
CtrlHAL x-[#black]>>x RespEx : Data transfer stopped
  activate CtrlHAL
CtrlEx <- - CtrlHAL: HAL_SPI_ErrorCallback,\nHAL_ERROR or HAL_TIMEOUT
  deactivate CtrlHAL

group Communication error handling
    alt Responder max attempts reached
      note over CtrlEx
        Stop the communication and exit app_process()
      endnote
			ref over CtrlEx, CtrlHAL
        Report the error status, see **error_handler()**
      end ref
		else #ALICEBLUE Responder retry
      note over CtrlEx, CtrlHAL
        Decrement the number of remaining attempts
      endnote
			ref over CtrlEx, CtrlHAL
			  Restart a new data exchange, see **exchanging data**
			end ref
		end
end

== ==
group#GOLD  error_handler()
  note over CtrlEx, CtrlHAL
    Responder stays in the error handler
  endnote
end
@enduml

@startuml spi-full-duplex-two-boards-com-dma-Responder_NominalCase
skinparam backgroundColor #EEEBDC
skinparam ParticipantPadding 20
skinparam BoxPadding 20
skinparam backgroundColor #EEEBDC
skinparam dpi 300

skinparam sequence {
	ArrowColor blue
	ActorBorderColor DeepSkyBlue
	LifeLineBorderColor blue
	LifeLineBackgroundColor #A9DCDF
	ArrowThickness 2
}

title **Nominal SPI full-duplex communication in DMA mode**

box "Responder Board"
	participant "Example" as CtrlEx #lightgreen
	participant "HAL Drivers" as CtrlHAL #lightblue
end box
box "Controller Board"
	participant "Example" as RespEx #lightgreen
end box

== Initialization: app_init() ==
activate CtrlEx
	note right CtrlEx
		The application initializes the SPI instance.
	endnote
activate RespEx

loop EXAMPLE_LOOP_COUNT times
  == app_process() ==
  loop Until max retry reached
    group Transmission and reception of data by the responder
      CtrlEx -> CtrlHAL : HAL_SPI_TransmitReceive_DMA
      activate CtrlHAL
      CtrlEx <- - CtrlHAL: HAL_OK
      CtrlHAL o<<-[#black]>>o RespEx : full-duplex data transfer between \nthe DMA and the Responder board

      alt transmission and reception success
        CtrlEx <- - CtrlHAL: HAL_SPI_TxRxCpltCallback
        deactivate CtrlHAL

      else #ALICEBLUE Transmission and/or reception error
        ref over CtrlEx, CtrlHAL
        New data exchange attempt, see **Communication error handling**
        end ref
      end

    end

    group Responder compares sent and received buffers
      alt identical
        note over CtrlEx, CtrlHAL
        The responder updates the transmission buffer for the next transfer
        end note

      else #ALICEBLUE different
        ref over CtrlEx, CtrlHAL
        New exchange attempt, see **Communication error handling**
        end ref

      end
    end
  end
  == ==

end
== Deinitialization: app_deinit() ==

group#GREEN  success_handler()
  note over CtrlEx, CtrlHAL
    Responder stays in the success handler
  endnote
end

newpage Attempts mechanism

== app_process() ==
... Data transfer ...
  note over CtrlEx,CtrlHAL
  Failure during SPI transmission and/or reception in DMA mode
  endnote
CtrlHAL x-[#black]>>x RespEx : Data transfer stopped
  activate CtrlHAL
CtrlEx <- - CtrlHAL: HAL_SPI_ErrorCallback,\nHAL_ERROR or HAL_TIMEOUT
  deactivate CtrlHAL

group Communication error handling
    alt Responder max attempts reached
      note over CtrlEx
        Stop the communication and exit app_process()
      endnote
			ref over CtrlEx, CtrlHAL
        Report the error status, see **error_handler()**
      end ref
		else #ALICEBLUE Responder retry
      note over CtrlEx, CtrlHAL
        Decrement the number of remaining attempts
      endnote
			ref over CtrlEx, CtrlHAL
			  Restart a new data exchange, see **exchanging data**
			end ref
		end
end

== ==
group#GOLD  error_handler()
  note over CtrlEx, CtrlHAL
    Responder stays in the error handler
  endnote
end
@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>